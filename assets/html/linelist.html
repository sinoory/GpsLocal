<html>
    <head>
        <script src="../js/jquery_mini.js"></script>
    </head>
    <body>
        <h3 id="idBusname" align="center" >Lines</h3>
        <div id="idlines">
        </div>
        <p id="console"></p>
        <script>
            function dbg(msg){
                $("#console").html(msg+"<br>"+$("#console").html());
            }
            $(document).ready(function(){
                dbg("ok ready sdcard");
                lines=window.jh.getShp("alllines");
                //dbg("lines="+lines);
                if(lines){
                    lines=lines.split(",");
                    var linehtml="";
                    for(var i=0;i<lines.length;i++){
                        linehtml+="<p id='idLine"+i+"' onclick='showOpr("+i+")'>"+lines[i]+"</p>";
                        linehtml+="<p align='right' id='idopr"+i+"' style='display:none'  ><button onclick='selectline()' >select</button>";
                        linehtml+="<button onclick='deleteline()'>deleteline</button>";
                        linehtml+="<button onclick='uploadline()'>upload</button>";
                        linehtml+="</p>";
                    }
                    $("#idlines").html(linehtml);
                }
            });
            var mLastShowOprLine=-1;
            function showOpr(line){
                //dbg("showOpr line="+line+",last="+mLastShowOprLine);
                if(mLastShowOprLine!=-1){
                    $("#idopr"+mLastShowOprLine).css("display","none");
                }
                mLastShowOprLine=line;
                $("#idopr"+mLastShowOprLine).css("display","block");
            }
            function selectline(){
                window.jh.setShp("lastLine",lines[mLastShowOprLine]);
            }
            function deleteline(){
                window.jh.rmShp(lines[mLastShowOprLine]);
                lines.splice(mLastShowOprLine,1);
                window.jh.setShp("alllines",lines.join(","));
                $("#idLine"+mLastShowOprLine).css("display","none");
                $("#idopr"+mLastShowOprLine).css("display","none");
            }
            function uploadline(){
                var jsline=JSON.parse(jh.getShp(lines[mLastShowOprLine]));
                var js={"type":"uploadLine","stations":jsline.stationUp,
                    "name":jsline.name,"ownerid":jh.getShp("id")};
                jh.sendMsg(JSON.stringify(js));
            }
            function getHMS(timstap){
                var ts=new Date(parseInt(timstap) * 1000).toLocaleString();
                return ts.split(" ")[4];
            }
        </script>
    </body>
</html>
